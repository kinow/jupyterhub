

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>Install JupyterHub and JupyterLab from the ground up &#8212; JupyterHub 1.2.0dev documentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Get Started" href="getting-started/index.html" />
    <link rel="prev" title="Installation Basics" href="installation-basics.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    
    <a class="navbar-brand" href="index.html">
      <img src="_static/logo.png" class="logo" alt="logo">
    </a>
    
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item active">
            <a class="nav-link" href="installation-guide.html">Installation</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="getting-started/index.html">Get Started</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="reference/index.html">Technical Reference</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="index-admin.html">Administrator’s Guide</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="api/index.html">JupyterHub API</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="contributing/index.html">Contributing</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="index-about.html">About</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar">

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>


<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

  <div class="bd-toc-item active">
  

  <ul class="nav bd-sidenav">
      
      
        
          
              <li class="">
                  <a href="quickstart.html">Quickstart</a>
              </li>
          
        
          
              <li class="">
                  <a href="quickstart-docker.html">Using Docker</a>
              </li>
          
        
          
              <li class="">
                  <a href="installation-basics.html">Installation Basics</a>
              </li>
          
        
          
              <li class="active">
                  <a href="">Install JupyterHub and JupyterLab from the ground up</a>
              </li>
          
        
      
      
      
      
      
      
      
      
      
      
      
      
      
      
    </ul>

</nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#prerequisites" class="nav-link">Prerequisites</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#goals" class="nav-link">Goals</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#part-1-jupyterhub-and-jupyterlab" class="nav-link">Part 1: JupyterHub and JupyterLab</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#setup-the-jupyterhub-and-jupyterlab-in-a-virtual-environment" class="nav-link">Setup the JupyterHub and JupyterLab in a virtual environment</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#create-the-configuration-for-jupyterhub" class="nav-link">Create the configuration for JupyterHub</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#setup-systemd-service" class="nav-link">Setup Systemd service</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#part-2-conda-environments" class="nav-link">Part 2: Conda environments</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#install-conda-for-the-whole-system" class="nav-link">Install conda for the whole system</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#install-a-default-conda-environment-for-all-users" class="nav-link">Install a default conda environment for all users</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#setting-up-users-own-conda-environments" class="nav-link">Setting up users’ own conda environments</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#setting-up-a-reverse-proxy" class="nav-link">Setting up a reverse proxy</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#using-nginx" class="nav-link">Using Nginx</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#getting-started-using-your-new-jupyterhub" class="nav-link">Getting started using your new JupyterHub</a>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="install-jupyterhub-and-jupyterlab-from-the-ground-up">
<h1>Install JupyterHub and JupyterLab from the ground up<a class="headerlink" href="#install-jupyterhub-and-jupyterlab-from-the-ground-up" title="Permalink to this headline">¶</a></h1>
<p>The combination of <a class="reference external" href="https://jupyterhub.readthedocs.io">JupyterHub</a> and <a class="reference external" href="https://jupyterlab.readthedocs.io">JupyterLab</a>
is a great way to make shared computing resources available to a group.</p>
<p>These instructions are a guide for a manual, ‘bare metal’ install of <a class="reference external" href="https://jupyterhub.readthedocs.io">JupyterHub</a>
and <a class="reference external" href="https://jupyterlab.readthedocs.io">JupyterLab</a>. This is ideal for running on a single server: build a beast
of a machine and share it within your lab, or use a virtual machine from any VPS or cloud provider.</p>
<p>This guide has similar goals to <a class="reference external" href="https://the-littlest-jupyterhub.readthedocs.io">The Littlest JupyterHub</a> setup
script. However, instead of bundling all these step for you into one installer, we will perform every step manually.
This makes it easy to customize any part (e.g. if you want to run other services on the same system and need to make them
work together), as well as giving you full control and understanding of your setup.</p>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Your own server with administrator (root) access. This could be a local machine, a remotely hosted one, or a cloud instance
or VPS. Each user who will access JupyterHub should have a standard user account on the machine. The install will be done
through the command line - useful if you log into your machine remotely using SSH.</p>
<p>This tutorial was tested on <strong>Ubuntu 18.04</strong>. No other Linux distributions have been tested, but the instructions
should be reasonably straightforward to adapt.</p>
</div>
<div class="section" id="goals">
<h2>Goals<a class="headerlink" href="#goals" title="Permalink to this headline">¶</a></h2>
<p>JupyterLab enables access to a multiple ‘kernels’, each one being a given environment for a given language. The most
common is a Python environment, for scientific computing usually one managed by the <code class="docutils literal notranslate"><span class="pre">conda</span></code> package manager.</p>
<p>This guide will set up JupyterHub and JupyterLab seperately from the Python environment. In other words, we treat
JupyterHub+JupyterLab as a ‘app’ or webservice, which will connect to the kernels available on the system. Specifically:</p>
<ul class="simple">
<li><p>We will create an installation of JupyterHub and JupyterLab using a virtualenv under <code class="docutils literal notranslate"><span class="pre">/opt</span></code> using the system Python.</p></li>
<li><p>We will install conda globally.</p></li>
<li><p>We will create a shared conda environment which can be used (but not modified) by all users.</p></li>
<li><p>We will show how users can create their own private conda environments, where they can install whatever they like.</p></li>
</ul>
<p>The default JupyterHub Authenticator uses PAM to authenticate system users with their username and password. One can
<a class="reference external" href="https://jupyterhub.readthedocs.io/en/stable/reference/authenticators.html#authenticators">choose the authenticator</a>
that best suits their needs. In this guide we will use the default Authenticator because it makes it easy for everyone to manage data
in their home folder and to mix and match different services and access methods (e.g. SSH) which all work using the
Linux system user accounts. Therefore, each user of JupyterHub will need a standard system user account.</p>
<p>Another goal of this guide is to use system provided packages wherever possible. This has the advantage that these packages
get automatic patches and security updates (be sure to turn on automatic updates in Ubuntu). This means less maintenance
work and a more reliable system.</p>
</div>
<div class="section" id="part-1-jupyterhub-and-jupyterlab">
<h2>Part 1: JupyterHub and JupyterLab<a class="headerlink" href="#part-1-jupyterhub-and-jupyterlab" title="Permalink to this headline">¶</a></h2>
<div class="section" id="setup-the-jupyterhub-and-jupyterlab-in-a-virtual-environment">
<h3>Setup the JupyterHub and JupyterLab in a virtual environment<a class="headerlink" href="#setup-the-jupyterhub-and-jupyterlab-in-a-virtual-environment" title="Permalink to this headline">¶</a></h3>
<p>First we create a virtual environment under ‘/opt/jupyterhub’. The ‘/opt’ folder is where apps not belonging to the operating
system are <a class="reference external" href="https://unix.stackexchange.com/questions/11544/what-is-the-difference-between-opt-and-usr-local">commonly installed</a>.
Both jupyterlab and jupyterhub will be installed into this virtualenv. Create it with the command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo python3 -m venv /opt/jupyterhub/
</pre></div>
</div>
<p>Now we use pip to install the required Python packages into the new virtual environment. Be sure to install
<code class="docutils literal notranslate"><span class="pre">wheel</span></code> first. Since we are separating the user interface from the computing kernels, we don’t install
any Python scientific packages here. The only exception is <code class="docutils literal notranslate"><span class="pre">ipywidgets</span></code> because this is needed to allow connection
between interactive tools running in the kernel and the user interface.</p>
<p>Note that we use <code class="docutils literal notranslate"><span class="pre">/opt/jupyterhub/bin/python3</span> <span class="pre">-m</span> <span class="pre">pip</span> <span class="pre">install</span></code> each time - this <a class="reference external" href="https://snarky.ca/why-you-should-use-python-m-pip/">makes sure</a>
that the packages are installed to the correct virtual environment.</p>
<p>Perform the install using the following commands:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo /opt/jupyterhub/bin/python3 -m pip install wheel
sudo /opt/jupyterhub/bin/python3 -m pip install jupyterhub jupyterlab
sudo /opt/jupyterhub/bin/python3 -m pip install ipywidgets
</pre></div>
</div>
<p>JupyterHub also currently defaults to requiring <code class="docutils literal notranslate"><span class="pre">configurable-http-proxy</span></code>, which needs <code class="docutils literal notranslate"><span class="pre">nodejs</span></code> and <code class="docutils literal notranslate"><span class="pre">npm</span></code>. The versions
of these available in Ubuntu therefore need to be installed first (they are a bit old but this is ok for our needs):</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo apt install nodejs npm
</pre></div>
</div>
<p>Then install <code class="docutils literal notranslate"><span class="pre">configurable-http-proxy</span></code>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo npm install -g configurable-http-proxy
</pre></div>
</div>
</div>
<div class="section" id="create-the-configuration-for-jupyterhub">
<h3>Create the configuration for JupyterHub<a class="headerlink" href="#create-the-configuration-for-jupyterhub" title="Permalink to this headline">¶</a></h3>
<p>Now we start creating configuration files. To keep everything together, we put all the configuration into the folder
created for the virtualenv, under <code class="docutils literal notranslate"><span class="pre">/opt/jupyterhub/etc/</span></code>. For each thing needing configuration, we will create a further
subfolder and necessary files.</p>
<p>First create the folder for the JupyterHub configuration and navigate to it:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo mkdir -p /opt/jupyterhub/etc/jupyterhub/
<span class="nb">cd</span> /opt/jupyterhub/etc/jupyterhub/
</pre></div>
</div>
<p>Then generate the default configuration file</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo /opt/jupyterhub/bin/jupyterhub --generate-config
</pre></div>
</div>
<p>This will produce the default configuration file <code class="docutils literal notranslate"><span class="pre">/opt/jupyterhub/etc/jupyterhub/jupyterhub_config.py</span></code></p>
<p>You will need to edit the configuration file to make the JupyterLab interface by the default.
Set the following configuration option in your <code class="docutils literal notranslate"><span class="pre">jupyterhub_config.py</span></code> file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">Spawner</span><span class="o">.</span><span class="n">default_url</span> <span class="o">=</span> <span class="s1">&#39;/lab&#39;</span>
</pre></div>
</div>
<p>Further configuration options may be found in the documentation.</p>
</div>
<div class="section" id="setup-systemd-service">
<h3>Setup Systemd service<a class="headerlink" href="#setup-systemd-service" title="Permalink to this headline">¶</a></h3>
<p>We will setup JupyterHub to run as a system service using Systemd (which is responsible for managing all services and
servers that run on startup in Ubuntu). We will create a service file in a suitable location in the virtualenv folder
and then link it to the system services. First create the folder for the service file:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo mkdir -p /opt/jupyterhub/etc/systemd
</pre></div>
</div>
<p>Then create the following text file using your <a class="reference external" href="https://micro-editor.github.io/">favourite editor</a> at</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>/opt/jupyterhub/etc/systemd/jupyterhub.service
</pre></div>
</div>
<p>Paste the following service unit definition into the file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Unit</span><span class="p">]</span>
<span class="n">Description</span><span class="o">=</span><span class="n">JupyterHub</span>
<span class="n">After</span><span class="o">=</span><span class="n">syslog</span><span class="o">.</span><span class="n">target</span> <span class="n">network</span><span class="o">.</span><span class="n">target</span>

<span class="p">[</span><span class="n">Service</span><span class="p">]</span>
<span class="n">User</span><span class="o">=</span><span class="n">root</span>
<span class="n">Environment</span><span class="o">=</span><span class="s2">&quot;PATH=/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/opt/jupyterhub/bin&quot;</span>
<span class="n">ExecStart</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">jupyterhub</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">jupyterhub</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">jupyterhub</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">jupyterhub</span><span class="o">/</span><span class="n">jupyterhub_config</span><span class="o">.</span><span class="n">py</span>

<span class="p">[</span><span class="n">Install</span><span class="p">]</span>
<span class="n">WantedBy</span><span class="o">=</span><span class="n">multi</span><span class="o">-</span><span class="n">user</span><span class="o">.</span><span class="n">target</span>
</pre></div>
</div>
<p>This sets up the environment to use the virtual environment we created, tells Systemd how to start jupyterhub using
the configuration file we created, specifies that jupyterhub will be started as the <code class="docutils literal notranslate"><span class="pre">root</span></code> user (needed so that it can
start jupyter on behalf of other logged in users), and specifies that jupyterhub should start on boot after the network
is enabled.</p>
<p>Finally, we need to make systemd aware of our service file. First we symlink our file into systemd’s directory:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo ln -s /opt/jupyterhub/etc/systemd/jupyterhub.service /etc/systemd/system/jupyterhub.service
</pre></div>
</div>
<p>Then tell systemd to reload its configuration files</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl daemon-reload
</pre></div>
</div>
<p>And finally enable the service</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl <span class="nb">enable</span> jupyterhub.service
</pre></div>
</div>
<p>The service will start on reboot, but we can start it straight away using:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl start jupyterhub.service
</pre></div>
</div>
<p>…and check that it’s running using:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl status jupyterhub.service
</pre></div>
</div>
<p>You should now be already be able to access jupyterhub using <code class="docutils literal notranslate"><span class="pre">&lt;your</span> <span class="pre">servers</span> <span class="pre">ip&gt;:8000</span></code> (assuming you haven’t already set
up a firewall or something). However, when you log in the jupyter notebooks will be trying to use the Python virtualenv
that was created to install JupyterHub, this is not what we want. So on to part 2</p>
</div>
</div>
<div class="section" id="part-2-conda-environments">
<h2>Part 2: Conda environments<a class="headerlink" href="#part-2-conda-environments" title="Permalink to this headline">¶</a></h2>
<div class="section" id="install-conda-for-the-whole-system">
<h3>Install conda for the whole system<a class="headerlink" href="#install-conda-for-the-whole-system" title="Permalink to this headline">¶</a></h3>
<p>We will use <code class="docutils literal notranslate"><span class="pre">conda</span></code> to manage Python environments. We will install the officially maintained <code class="docutils literal notranslate"><span class="pre">conda</span></code> packages for Ubuntu,
this means they will get automatic updates with the rest of the system. Setup repo for the official Conda debian packages,
instructions are copied from <a class="reference external" href="https://docs.conda.io/projects/conda/en/latest/user-guide/install/rpm-debian.html">here</a>:</p>
<p>Install Anacononda public gpg key to trusted store</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>curl https://repo.anaconda.com/pkgs/misc/gpgkeys/anaconda.asc <span class="p">|</span> gpg --dearmor &gt; conda.gpg
sudo install -o root -g root -m <span class="m">644</span> conda.gpg /etc/apt/trusted.gpg.d/
</pre></div>
</div>
<p>Add Debian repo</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">&quot;deb [arch=amd64] https://repo.anaconda.com/pkgs/misc/debrepo/conda stable main&quot;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/conda.list
</pre></div>
</div>
<p>Install conda</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo apt update
sudo apt install conda
</pre></div>
</div>
<p>This will install conda into the folder <code class="docutils literal notranslate"><span class="pre">/opt/conda/</span></code>, with the conda command available at <code class="docutils literal notranslate"><span class="pre">/opt/conda/bin/conda</span></code>.</p>
<p>Finally, we can make conda more easily available to users by symlinking the conda shell setup script to the profile
‘drop in’ folder so that it gets run on login</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo ln -s /opt/conda/etc/profile.d/conda.sh /etc/profile.d/conda.sh
</pre></div>
</div>
</div>
<div class="section" id="install-a-default-conda-environment-for-all-users">
<h3>Install a default conda environment for all users<a class="headerlink" href="#install-a-default-conda-environment-for-all-users" title="Permalink to this headline">¶</a></h3>
<p>First create a folder for conda envs (might exist already):</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo mkdir /opt/conda/envs/
</pre></div>
</div>
<p>Then create a conda environment to your liking within that folder. Here we have called it ‘python’ because it will
be the obvious default - call it whatever you like. You can install whatever you like into this environment, but you MUST at least install <code class="docutils literal notranslate"><span class="pre">ipykernel</span></code>.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo /opt/conda/bin/conda create --prefix /opt/conda/envs/python <span class="nv">python</span><span class="o">=</span><span class="m">3</span>.7 ipykernel
</pre></div>
</div>
<p>Once your env is set up as desired, make it visible to Jupyter by installing the kernel spec. There are two options here:</p>
<p>1 ) Install into the JupyterHub virtualenv - this ensures it overrides the default python version. It will only be visible
to the JupyterHub installation we have just created. This is useful to avoid conda environments appearing where they are not expected.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo /opt/conda/envs/python/bin/python -m ipykernel install --prefix<span class="o">=</span>/opt/jupyterhub/ --name <span class="s1">&#39;python&#39;</span> --display-name <span class="s2">&quot;Python (default)&quot;</span>
</pre></div>
</div>
<p>2 ) Install it system-wide by putting it into <code class="docutils literal notranslate"><span class="pre">/usr/local</span></code>. It will be visible to any parallel install of JupyterHub or
JupyterLab, and will persist even if you later delete or modify the JupyterHub installation. This is useful if the kernels
might be used by other services, or if you want to modify the JupyterHub installation independently from the conda environments.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo /opt/conda/envs/python/bin/python -m ipykernel install --prefix /usr/local/ --name <span class="s1">&#39;python&#39;</span> --display-name <span class="s2">&quot;Python (default)&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-up-users-own-conda-environments">
<h3>Setting up users’ own conda environments<a class="headerlink" href="#setting-up-users-own-conda-environments" title="Permalink to this headline">¶</a></h3>
<p>There is relatively little for the administrator to do here, as users will have to set up their own environments using the shell.
On login they should run <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">init</span></code> or  <code class="docutils literal notranslate"><span class="pre">/opt/conda/bin/conda</span></code>. The can then use conda to set up their environment,
although they must also install <code class="docutils literal notranslate"><span class="pre">ipykernel</span></code>. Once done, they can enable their kernel using:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>/path/to/kernel/env/bin/python -m ipykernel install --name <span class="s1">&#39;python-my-env&#39;</span> --display-name <span class="s2">&quot;Python My Env&quot;</span>
</pre></div>
</div>
<p>This will place the kernel spec into their home folder, where Jupyter will look for it on startup.</p>
</div>
</div>
<div class="section" id="setting-up-a-reverse-proxy">
<h2>Setting up a reverse proxy<a class="headerlink" href="#setting-up-a-reverse-proxy" title="Permalink to this headline">¶</a></h2>
<p>The guide so far results in JupyterHub running on port 8000. It is not generally advisable to run open web services in
this way - instead, use a reverse proxy running on standard HTTP/HTTPS ports.</p>
<blockquote>
<div><p><strong>Important</strong>: Be aware of the security implications especially if you are running a server that is accessible from the open internet
i.e. not protected within an institutional intranet or private home/office network. You should set up a firewall and
HTTPS encryption, which is outside of the scope of this guide. For HTTPS consider using <a class="reference external" href="https://letsencrypt.org/">LetsEncrypt</a>
or setting up a <a class="reference external" href="https://www.digitalocean.com/community/tutorials/how-to-create-a-self-signed-ssl-certificate-for-nginx-in-ubuntu-18-04">self-signed certificate</a>.
Firewalls may be set up using <code class="docutils literal notranslate"><span class="pre">ufw</span></code> or <code class="docutils literal notranslate"><span class="pre">firewalld</span></code> and combined with <code class="docutils literal notranslate"><span class="pre">fail2ban</span></code>.</p>
</div></blockquote>
<div class="section" id="using-nginx">
<h3>Using Nginx<a class="headerlink" href="#using-nginx" title="Permalink to this headline">¶</a></h3>
<p>Nginx is a mature and established web server and reverse proxy and is easy to install using <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">install</span> <span class="pre">nginx</span></code>.
Details on using Nginx as a reverse proxy can be found elsewhere. Here, we will only outline the additional steps needed
to setup JupyterHub with Nginx and host it at a given URL e.g. <code class="docutils literal notranslate"><span class="pre">&lt;your-server-ip-or-url&gt;/jupyter</span></code>.
This could be useful for example if you are running several services or web pages on the same server.</p>
<p>To achieve this needs a few tweaks to both the JupyterHub configuration and the Nginx config. First, edit the
configuration file <code class="docutils literal notranslate"><span class="pre">/opt/jupyterhub/etc/jupyterhub/jupyterhub_config.py</span></code> and add the line:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">JupyterHub</span><span class="o">.</span><span class="n">bind_url</span> <span class="o">=</span> <span class="s1">&#39;http://:8000/jupyter&#39;</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">/jupyter</span></code> will be the relative URL of the JupyterHub.</p>
<p>Now Nginx must be configured with a to pass all traffic from <code class="docutils literal notranslate"><span class="pre">/jupyter</span></code> to the the local address <code class="docutils literal notranslate"><span class="pre">127.0.0.1:8000</span></code>.
Add the following snippet to your nginx configuration file (e.g. <code class="docutils literal notranslate"><span class="pre">/etc/nginx/sites-available/default</span></code>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  location /jupyter/ {
    # NOTE important to also set base url of jupyterhub to /jupyter in its config
    proxy_pass http://127.0.0.1:8000;

    proxy_redirect   off;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # websocket headers
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection $connection_upgrade;

  }
</pre></div>
</div>
<p>Also add this snippet before the <em>server</em> block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>map $http_upgrade $connection_upgrade {
        default upgrade;
        &#39;&#39; close;
    }
</pre></div>
</div>
<p>Nginx will not run if there are errors in the configuration, check your configuration using:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>nginx -t
</pre></div>
</div>
<p>If there are no errors, you can restart the Nginx service for the new configuration to take effect.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo systemctl restart nginx.service
</pre></div>
</div>
</div>
</div>
<div class="section" id="getting-started-using-your-new-jupyterhub">
<h2>Getting started using your new JupyterHub<a class="headerlink" href="#getting-started-using-your-new-jupyterhub" title="Permalink to this headline">¶</a></h2>
<p>Once you have setup JupyterHub and Nginx proxy as described, you can browse to your JupyterHub IP or URL
(e.g. if your server IP address is <code class="docutils literal notranslate"><span class="pre">123.456.789.1</span></code> and you decided to host JupyterHub at the <code class="docutils literal notranslate"><span class="pre">/jupyter</span></code> URL, browse
to <code class="docutils literal notranslate"><span class="pre">123.456.789.1/jupyter</span></code>). You will find a login page where you enter your Linux username and password. On login
you will be presented with the JupyterLab interface, with the file browser pane showing the contents of your users’
home directory on the server.</p>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="installation-basics.html" title="previous page">Installation Basics</a>
    <a class='right-next' id="next-link" href="getting-started/index.html" title="next page">Get Started</a>

              </div>
              
          </main>
          

      </div>
    </div>

    <script src="_static/js/index.js"></script>
    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2016, Project Jupyter team.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>