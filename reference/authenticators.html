

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>Authenticators &#8212; JupyterHub 1.2.0dev documentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Spawners" href="spawners.html" />
    <link rel="prev" title="Security Overview" href="websecurity.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    
    <a class="navbar-brand" href="../index.html">
      <img src="../_static/logo.png" class="logo" alt="logo">
    </a>
    
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../installation-guide.html">Installation</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../getting-started/index.html">Get Started</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="index.html">Technical Reference</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../index-admin.html">Administrator’s Guide</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../api/index.html">JupyterHub API</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../contributing/index.html">Contributing</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../index-about.html">About</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar">

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>


<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

  <div class="bd-toc-item active">
  

  <ul class="nav bd-sidenav">
      
      
      
      
      
      
        
          
              <li class="">
                  <a href="technical-overview.html">Technical Overview</a>
              </li>
          
        
          
              <li class="">
                  <a href="urls.html">JupyterHub URL scheme</a>
              </li>
          
        
          
              <li class="">
                  <a href="websecurity.html">Security Overview</a>
              </li>
          
        
          
              <li class="active">
                  <a href="">Authenticators</a>
              </li>
          
        
          
              <li class="">
                  <a href="spawners.html">Spawners</a>
              </li>
          
        
          
              <li class="">
                  <a href="services.html">Services</a>
              </li>
          
        
          
              <li class="">
                  <a href="proxy.html">Writing a custom Proxy implementation</a>
              </li>
          
        
          
              <li class="">
                  <a href="separate-proxy.html">Running proxy separately from the hub</a>
              </li>
          
        
          
              <li class="">
                  <a href="rest.html">Using JupyterHub’s REST API</a>
              </li>
          
        
          
              <li class="">
                  <a href="database.html">The Hub’s Database</a>
              </li>
          
        
          
              <li class="">
                  <a href="templates.html">Working with templates and UI</a>
              </li>
          
        
          
              <li class="">
                  <a href="../events/index.html">Eventlogging and Telemetry</a>
              </li>
          
        
          
              <li class="">
                  <a href="config-user-env.html">Configuring user environments</a>
              </li>
          
        
          
              <li class="">
                  <a href="config-examples.html">Configuration examples</a>
              </li>
          
        
          
              <li class="">
                  <a href="config-ghoauth.html">Configure GitHub OAuth</a>
              </li>
          
        
          
              <li class="">
                  <a href="config-proxy.html">Using a reverse proxy</a>
              </li>
          
        
          
              <li class="">
                  <a href="config-sudo.html">Run JupyterHub without root privileges using sudo</a>
              </li>
          
        
          
              <li class="">
                  <a href="config-reference.html">Configuration Reference</a>
              </li>
          
        
      
      
      
      
      
      
      
      
      
      
    </ul>

</nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#the-default-pam-authenticator" class="nav-link">The default PAM Authenticator</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#the-oauthenticator" class="nav-link">The OAuthenticator</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#the-dummy-authenticator" class="nav-link">The Dummy Authenticator</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#additional-authenticators" class="nav-link">Additional Authenticators</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#technical-overview-of-authentication" class="nav-link">Technical Overview of Authentication</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#how-the-base-authenticator-works" class="nav-link">How the Base Authenticator works</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h4">
            <a href="#authenticator-authenticate-method" class="nav-link">Authenticator.authenticate method</a>
        </li>
    
        <li class="nav-item toc-entry toc-h4">
            <a href="#normalize-usernames" class="nav-link">Normalize usernames</a>
        </li>
    
        <li class="nav-item toc-entry toc-h4">
            <a href="#validate-usernames" class="nav-link">Validate usernames</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#how-to-write-a-custom-authenticator" class="nav-link">How to write a custom authenticator</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#registering-custom-authenticators-via-entry-points" class="nav-link">Registering custom Authenticators via entry points</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#authentication-state" class="nav-link">Authentication state</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h4">
            <a href="#using-auth-state" class="nav-link">Using auth_state</a>
        </li>
    
            </ul>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#pre-spawn-start-and-post-spawn-stop-hooks" class="nav-link">pre_spawn_start and post_spawn_stop hooks</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#jupyterhub-as-an-oauth-provider" class="nav-link">JupyterHub as an OAuth provider</a>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="authenticators">
<h1>Authenticators<a class="headerlink" href="#authenticators" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference external" href="https://github.com/jupyterhub/jupyterhub/blob/master/jupyterhub/auth.py">Authenticator</a> is the mechanism for authorizing users to use the
Hub and single user notebook servers.</p>
<div class="section" id="the-default-pam-authenticator">
<h2>The default PAM Authenticator<a class="headerlink" href="#the-default-pam-authenticator" title="Permalink to this headline">¶</a></h2>
<p>JupyterHub ships with the default <a class="reference external" href="https://en.wikipedia.org/wiki/Pluggable_authentication_module">PAM</a>-based Authenticator, for
logging in with local user accounts via a username and password.</p>
</div>
<div class="section" id="the-oauthenticator">
<h2>The OAuthenticator<a class="headerlink" href="#the-oauthenticator" title="Permalink to this headline">¶</a></h2>
<p>Some login mechanisms, such as <a class="reference external" href="https://en.wikipedia.org/wiki/OAuth">OAuth</a>, don’t map onto username and
password authentication, and instead use tokens. When using these
mechanisms, you can override the login handlers.</p>
<p>You can see an example implementation of an Authenticator that uses
<a class="reference external" href="https://developer.github.com/v3/oauth/">GitHub OAuth</a> at <a class="reference external" href="https://github.com/jupyterhub/oauthenticator">OAuthenticator</a>.</p>
<p>JupyterHub’s <a class="reference external" href="https://github.com/jupyterhub/oauthenticator">OAuthenticator</a> currently supports the following
popular services:</p>
<ul class="simple">
<li><p>Auth0</p></li>
<li><p>Bitbucket</p></li>
<li><p>CILogon</p></li>
<li><p>GitHub</p></li>
<li><p>GitLab</p></li>
<li><p>Globus</p></li>
<li><p>Google</p></li>
<li><p>MediaWiki</p></li>
<li><p>Okpy</p></li>
<li><p>OpenShift</p></li>
</ul>
<p>A generic implementation, which you can use for OAuth authentication
with any provider, is also available.</p>
</div>
<div class="section" id="the-dummy-authenticator">
<h2>The Dummy Authenticator<a class="headerlink" href="#the-dummy-authenticator" title="Permalink to this headline">¶</a></h2>
<p>When testing, it may be helpful to use the
:class:<code class="docutils literal notranslate"><span class="pre">~jupyterhub.auth.DummyAuthenticator</span></code>. This allows for any username and
password unless if a global password has been set. Once set, any username will
still be accepted but the correct password will need to be provided.</p>
</div>
<div class="section" id="additional-authenticators">
<h2>Additional Authenticators<a class="headerlink" href="#additional-authenticators" title="Permalink to this headline">¶</a></h2>
<p>A partial list of other authenticators is available on the
<a class="reference external" href="https://github.com/jupyterhub/jupyterhub/wiki/Authenticators">JupyterHub wiki</a>.</p>
</div>
<div class="section" id="technical-overview-of-authentication">
<h2>Technical Overview of Authentication<a class="headerlink" href="#technical-overview-of-authentication" title="Permalink to this headline">¶</a></h2>
<div class="section" id="how-the-base-authenticator-works">
<h3>How the Base Authenticator works<a class="headerlink" href="#how-the-base-authenticator-works" title="Permalink to this headline">¶</a></h3>
<p>The base authenticator uses simple username and password authentication.</p>
<p>The base Authenticator has one central method:</p>
<div class="section" id="authenticator-authenticate-method">
<h4>Authenticator.authenticate method<a class="headerlink" href="#authenticator-authenticate-method" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Authenticator</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>This method is passed the Tornado <code class="docutils literal notranslate"><span class="pre">RequestHandler</span></code> and the <code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">data</span></code>
from JupyterHub’s login form. Unless the login form has been customized,
<code class="docutils literal notranslate"><span class="pre">data</span></code> will have two keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">username</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">password</span></code></p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">authenticate</span></code> method’s job is simple:</p>
<ul class="simple">
<li><p>return the username (non-empty str) of the authenticated user if
authentication is successful</p></li>
<li><p>return <code class="docutils literal notranslate"><span class="pre">None</span></code> otherwise</p></li>
</ul>
<p>Writing an Authenticator that looks up passwords in a dictionary
requires only overriding this one method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.utils.traitlets</span> <span class="kn">import</span> <span class="n">Dict</span>
<span class="kn">from</span> <span class="nn">jupyterhub.auth</span> <span class="kn">import</span> <span class="n">Authenticator</span>

<span class="k">class</span> <span class="nc">DictionaryAuthenticator</span><span class="p">(</span><span class="n">Authenticator</span><span class="p">):</span>

    <span class="n">passwords</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;dict of username:password for authentication&quot;&quot;&quot;</span>
    <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">passwords</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="normalize-usernames">
<h4>Normalize usernames<a class="headerlink" href="#normalize-usernames" title="Permalink to this headline">¶</a></h4>
<p>Since the Authenticator and Spawner both use the same username,
sometimes you want to transform the name coming from the authentication service
(e.g. turning email addresses into local system usernames) before adding them to the Hub service.
Authenticators can define <code class="docutils literal notranslate"><span class="pre">normalize_username</span></code>, which takes a username.
The default normalization is to cast names to lowercase</p>
<p>For simple mappings, a configurable dict <code class="docutils literal notranslate"><span class="pre">Authenticator.username_map</span></code> is used to turn one name into another:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">Authenticator</span><span class="o">.</span><span class="n">username_map</span>  <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;service-name&#39;</span><span class="p">:</span> <span class="s1">&#39;localname&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When using <code class="docutils literal notranslate"><span class="pre">PAMAuthenticator</span></code>, you can set
<code class="docutils literal notranslate"><span class="pre">c.PAMAuthenticator.pam_normalize_username</span> <span class="pre">=</span> <span class="pre">True</span></code>, which will
normalize usernames using PAM (basically round-tripping them: username
to uid to username), which is useful in case you use some external
service that allows multiple usernames mapping to the same user (such
as ActiveDirectory, yes, this really happens).  When
<code class="docutils literal notranslate"><span class="pre">pam_normalize_username</span></code> is on, usernames are <em>not</em> normalized to
lowercase.</p>
</div>
<div class="section" id="validate-usernames">
<h4>Validate usernames<a class="headerlink" href="#validate-usernames" title="Permalink to this headline">¶</a></h4>
<p>In most cases, there is a very limited set of acceptable usernames.
Authenticators can define <code class="docutils literal notranslate"><span class="pre">validate_username(username)</span></code>,
which should return True for a valid username and False for an invalid one.
The primary effect this has is improving error messages during user creation.</p>
<p>The default behavior is to use configurable <code class="docutils literal notranslate"><span class="pre">Authenticator.username_pattern</span></code>,
which is a regular expression string for validation.</p>
<p>To only allow usernames that start with ‘w’:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">Authenticator</span><span class="o">.</span><span class="n">username_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;w.*&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="how-to-write-a-custom-authenticator">
<h3>How to write a custom authenticator<a class="headerlink" href="#how-to-write-a-custom-authenticator" title="Permalink to this headline">¶</a></h3>
<p>You can use custom Authenticator subclasses to enable authentication
via other mechanisms. One such example is using <a class="reference external" href="https://developer.github.com/v3/oauth/">GitHub OAuth</a>.</p>
<p>Because the username is passed from the Authenticator to the Spawner,
a custom Authenticator and Spawner are often used together.
For example, the Authenticator methods, <a class="reference external" href="https://jupyterhub.readthedocs.io/en/latest/api/auth.html#jupyterhub.auth.Authenticator.pre_spawn_start">pre_spawn_start(user, spawner)</a>
and <a class="reference external" href="https://jupyterhub.readthedocs.io/en/latest/api/auth.html#jupyterhub.auth.Authenticator.post_spawn_stop">post_spawn_stop(user, spawner)</a>, are hooks that can be used to do
auth-related startup (e.g. opening PAM sessions) and cleanup
(e.g. closing PAM sessions).</p>
<p>See a list of custom Authenticators <a class="reference external" href="https://github.com/jupyterhub/jupyterhub/wiki/Authenticators">on the wiki</a>.</p>
<p>If you are interested in writing a custom authenticator, you can read
<a class="reference external" href="http://jupyterhub-tutorial.readthedocs.io/en/latest/authenticators.html">this tutorial</a>.</p>
</div>
<div class="section" id="registering-custom-authenticators-via-entry-points">
<h3>Registering custom Authenticators via entry points<a class="headerlink" href="#registering-custom-authenticators-via-entry-points" title="Permalink to this headline">¶</a></h3>
<p>As of JupyterHub 1.0, custom authenticators can register themselves via
the <code class="docutils literal notranslate"><span class="pre">jupyterhub.authenticators</span></code> entry point metadata.
To do this, in your <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> add:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">setup</span><span class="p">(</span>
  <span class="o">...</span>
  <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;jupyterhub.authenticators&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;myservice = mypackage:MyAuthenticator&#39;</span><span class="p">,</span>
    <span class="p">],</span>
  <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>If you have added this metadata to your package,
users can select your authenticator with the configuration:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">JupyterHub</span><span class="o">.</span><span class="n">authenticator_class</span> <span class="o">=</span> <span class="s1">&#39;myservice&#39;</span>
</pre></div>
</div>
<p>instead of the full</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">JupyterHub</span><span class="o">.</span><span class="n">authenticator_class</span> <span class="o">=</span> <span class="s1">&#39;mypackage:MyAuthenticator&#39;</span>
</pre></div>
</div>
<p>previously required.
Additionally, configurable attributes for your authenticator will
appear in jupyterhub help output and auto-generated configuration files
via <code class="docutils literal notranslate"><span class="pre">jupyterhub</span> <span class="pre">--generate-config</span></code>.</p>
</div>
<div class="section" id="authentication-state">
<h3>Authentication state<a class="headerlink" href="#authentication-state" title="Permalink to this headline">¶</a></h3>
<p>JupyterHub 0.8 adds the ability to persist state related to authentication,
such as auth-related tokens.
If such state should be persisted, <code class="docutils literal notranslate"><span class="pre">.authenticate()</span></code> should return a dictionary of the form:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
  <span class="s1">&#39;auth_state&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">username</span></code> is the username that has been authenticated,
and <code class="docutils literal notranslate"><span class="pre">auth_state</span></code> is any JSON-serializable dictionary.</p>
<p>Because <code class="docutils literal notranslate"><span class="pre">auth_state</span></code> may contain sensitive information,
it is encrypted before being stored in the database.
To store auth_state, two conditions must be met:</p>
<ol>
<li><p>persisting auth state must be enabled explicitly via configuration</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">Authenticator</span><span class="o">.</span><span class="n">enable_auth_state</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</li>
<li><p>encryption must be enabled by the presence of <code class="docutils literal notranslate"><span class="pre">JUPYTERHUB_CRYPT_KEY</span></code> environment variable,
which should be a hex-encoded 32-byte key.
For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">JUPYTERHUB_CRYPT_KEY</span><span class="o">=</span><span class="k">$(</span>openssl rand -hex <span class="m">32</span><span class="k">)</span>
</pre></div>
</div>
</li>
</ol>
<p>JupyterHub uses <a class="reference external" href="https://cryptography.io/en/latest/fernet/">Fernet</a> to encrypt auth_state.
To facilitate key-rotation, <code class="docutils literal notranslate"><span class="pre">JUPYTERHUB_CRYPT_KEY</span></code> may be a semicolon-separated list of encryption keys.
If there are multiple keys present, the <strong>first</strong> key is always used to persist any new auth_state.</p>
<div class="section" id="using-auth-state">
<h4>Using auth_state<a class="headerlink" href="#using-auth-state" title="Permalink to this headline">¶</a></h4>
<p>Typically, if <code class="docutils literal notranslate"><span class="pre">auth_state</span></code> is persisted it is desirable to affect the Spawner environment in some way.
This may mean defining environment variables, placing certificate in the user’s home directory, etc.
The <code class="docutils literal notranslate"><span class="pre">Authenticator.pre_spawn_start</span></code> method can be used to pass information from authenticator state
to Spawner environment:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyAuthenticator</span><span class="p">(</span><span class="n">Authenticator</span><span class="p">):</span>
    <span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">username</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">identify_user</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">upstream_token</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">token_for_user</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
            <span class="s1">&#39;auth_state&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;upstream_token&#39;</span><span class="p">:</span> <span class="n">upstream_token</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>

    <span class="nd">@gen</span><span class="o">.</span><span class="n">coroutine</span>
    <span class="k">def</span> <span class="nf">pre_spawn_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">spawner</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pass upstream_token to spawner via environment variable&quot;&quot;&quot;</span>
        <span class="n">auth_state</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">user</span><span class="o">.</span><span class="n">get_auth_state</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">auth_state</span><span class="p">:</span>
            <span class="c1"># auth_state not enabled</span>
            <span class="k">return</span>
        <span class="n">spawner</span><span class="o">.</span><span class="n">environment</span><span class="p">[</span><span class="s1">&#39;UPSTREAM_TOKEN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">auth_state</span><span class="p">[</span><span class="s1">&#39;upstream_token&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="pre-spawn-start-and-post-spawn-stop-hooks">
<h2>pre_spawn_start and post_spawn_stop hooks<a class="headerlink" href="#pre-spawn-start-and-post-spawn-stop-hooks" title="Permalink to this headline">¶</a></h2>
<p>Authenticators uses two hooks, <a class="reference external" href="https://jupyterhub.readthedocs.io/en/latest/api/auth.html#jupyterhub.auth.Authenticator.pre_spawn_start">pre_spawn_start(user, spawner)</a> and
<a class="reference external" href="https://jupyterhub.readthedocs.io/en/latest/api/auth.html#jupyterhub.auth.Authenticator.post_spawn_stop">post_spawn_stop(user, spawner)</a> to add pass additional state information
between the authenticator and a spawner. These hooks are typically used auth-related
startup, i.e. opening a PAM session, and auth-related cleanup, i.e. closing a
PAM session.</p>
</div>
<div class="section" id="jupyterhub-as-an-oauth-provider">
<h2>JupyterHub as an OAuth provider<a class="headerlink" href="#jupyterhub-as-an-oauth-provider" title="Permalink to this headline">¶</a></h2>
<p>Beginning with version 0.8, JupyterHub is an OAuth provider.</p>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="websecurity.html" title="previous page">Security Overview</a>
    <a class='right-next' id="next-link" href="spawners.html" title="next page">Spawners</a>

              </div>
              
          </main>
          

      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2016, Project Jupyter team.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>