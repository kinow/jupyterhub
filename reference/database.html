

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>The Hub’s Database &#8212; JupyterHub 1.2.0dev documentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Working with templates and UI" href="templates.html" />
    <link rel="prev" title="Using JupyterHub’s REST API" href="rest.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    
    <a class="navbar-brand" href="../index.html">
      <img src="../_static/logo.png" class="logo" alt="logo">
    </a>
    
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../installation-guide.html">Installation</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../getting-started/index.html">Get Started</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="index.html">Technical Reference</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../index-admin.html">Administrator’s Guide</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../api/index.html">JupyterHub API</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../contributing/index.html">Contributing</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../index-about.html">About</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar">

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>


<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

  <div class="bd-toc-item active">
  

  <ul class="nav bd-sidenav">
      
      
      
      
      
      
        
          
              <li class="">
                  <a href="technical-overview.html">Technical Overview</a>
              </li>
          
        
          
              <li class="">
                  <a href="urls.html">JupyterHub URL scheme</a>
              </li>
          
        
          
              <li class="">
                  <a href="websecurity.html">Security Overview</a>
              </li>
          
        
          
              <li class="">
                  <a href="authenticators.html">Authenticators</a>
              </li>
          
        
          
              <li class="">
                  <a href="spawners.html">Spawners</a>
              </li>
          
        
          
              <li class="">
                  <a href="services.html">Services</a>
              </li>
          
        
          
              <li class="">
                  <a href="proxy.html">Writing a custom Proxy implementation</a>
              </li>
          
        
          
              <li class="">
                  <a href="separate-proxy.html">Running proxy separately from the hub</a>
              </li>
          
        
          
              <li class="">
                  <a href="rest.html">Using JupyterHub’s REST API</a>
              </li>
          
        
          
              <li class="active">
                  <a href="">The Hub’s Database</a>
              </li>
          
        
          
              <li class="">
                  <a href="templates.html">Working with templates and UI</a>
              </li>
          
        
          
              <li class="">
                  <a href="../events/index.html">Eventlogging and Telemetry</a>
              </li>
          
        
          
              <li class="">
                  <a href="config-user-env.html">Configuring user environments</a>
              </li>
          
        
          
              <li class="">
                  <a href="config-examples.html">Configuration examples</a>
              </li>
          
        
          
              <li class="">
                  <a href="config-ghoauth.html">Configure GitHub OAuth</a>
              </li>
          
        
          
              <li class="">
                  <a href="config-proxy.html">Using a reverse proxy</a>
              </li>
          
        
          
              <li class="">
                  <a href="config-sudo.html">Run JupyterHub without root privileges using sudo</a>
              </li>
          
        
          
              <li class="">
                  <a href="config-reference.html">Configuration Reference</a>
              </li>
          
        
      
      
      
      
      
      
      
      
      
      
    </ul>

</nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#default-sqlite-database" class="nav-link">Default SQLite database</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#using-an-rdbms-postgresql-mysql" class="nav-link">Using an RDBMS (PostgreSQL, MySQL)</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#notes-and-tips" class="nav-link">Notes and Tips</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#sqlite" class="nav-link">SQLite</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#postgresql" class="nav-link">PostgreSQL</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#mysql-mariadb" class="nav-link">MySQL / MariaDB</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="the-hub-s-database">
<h1>The Hub’s Database<a class="headerlink" href="#the-hub-s-database" title="Permalink to this headline">¶</a></h1>
<p>JupyterHub uses a database to store information about users, services, and other
data needed for operating the Hub.</p>
<div class="section" id="default-sqlite-database">
<h2>Default SQLite database<a class="headerlink" href="#default-sqlite-database" title="Permalink to this headline">¶</a></h2>
<p>The default database for JupyterHub is a <a class="reference external" href="https://sqlite.org">SQLite</a> database.
We have chosen SQLite as JupyterHub’s default for its lightweight simplicity
in certain uses such as testing, small deployments and workshops.</p>
<p>For production systems, SQLite has some disadvantages when used with JupyterHub:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">upgrade-db</span></code> may not work, and you may need to start with a fresh database</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">downgrade-db</span></code> <strong>will not</strong> work if you want to rollback to an earlier
version, so backup the <code class="docutils literal notranslate"><span class="pre">jupyterhub.sqlite</span></code> file before upgrading</p></li>
</ul>
<p>The sqlite documentation provides a helpful page about <a class="reference external" href="https://sqlite.org/whentouse.html">when to use SQLite and
where traditional RDBMS may be a better choice</a>.</p>
</div>
<div class="section" id="using-an-rdbms-postgresql-mysql">
<h2>Using an RDBMS (PostgreSQL, MySQL)<a class="headerlink" href="#using-an-rdbms-postgresql-mysql" title="Permalink to this headline">¶</a></h2>
<p>When running a long term deployment or a production system, we recommend using
a traditional RDBMS database, such as <a class="reference external" href="https://www.postgresql.org">PostgreSQL</a>
or <a class="reference external" href="https://www.mysql.com">MySQL</a>, that supports the SQL <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span></code>
statement.</p>
</div>
<div class="section" id="notes-and-tips">
<h2>Notes and Tips<a class="headerlink" href="#notes-and-tips" title="Permalink to this headline">¶</a></h2>
<div class="section" id="sqlite">
<h3>SQLite<a class="headerlink" href="#sqlite" title="Permalink to this headline">¶</a></h3>
<p>The SQLite database should not be used on NFS. SQLite uses reader/writer locks
to control access to the database. This locking mechanism might not work
correctly if the database file is kept on an NFS filesystem. This is because
<code class="docutils literal notranslate"><span class="pre">fcntl()</span></code> file locking is broken on many NFS implementations. Therefore, you
should avoid putting SQLite database files on NFS since it will not handle well
multiple processes which might try to access the file at the same time.</p>
</div>
<div class="section" id="postgresql">
<h3>PostgreSQL<a class="headerlink" href="#postgresql" title="Permalink to this headline">¶</a></h3>
<p>We recommend using PostgreSQL for production if you are unsure whether to use
MySQL or PostgreSQL or if you do not have a strong preference. There is
additional configuration required for MySQL that is not needed for PostgreSQL.</p>
</div>
<div class="section" id="mysql-mariadb">
<h3>MySQL / MariaDB<a class="headerlink" href="#mysql-mariadb" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>You should use the <code class="docutils literal notranslate"><span class="pre">pymysql</span></code> sqlalchemy provider (the other one, MySQLdb,
isn’t available for py3).</p></li>
<li><p>You also need to set <code class="docutils literal notranslate"><span class="pre">pool_recycle</span></code> to some value (typically 60 - 300)
which depends on your  MySQL setup. This is necessary since MySQL kills
connections serverside if they’ve been idle for a while, and the connection
from the hub will be idle for longer than most connections. This behavior
will lead to frustrating ‘the connection has gone away’ errors from
sqlalchemy if <code class="docutils literal notranslate"><span class="pre">pool_recycle</span></code> is not set.</p></li>
<li><p>If you use <code class="docutils literal notranslate"><span class="pre">utf8mb4</span></code> collation with MySQL earlier than 5.7.7 or MariaDB
earlier than 10.2.1 you may get an <code class="docutils literal notranslate"><span class="pre">1709,</span> <span class="pre">Index</span> <span class="pre">column</span> <span class="pre">size</span> <span class="pre">too</span> <span class="pre">large</span></code> error.
To fix this you need to set <code class="docutils literal notranslate"><span class="pre">innodb_large_prefix</span></code> to enabled and
<code class="docutils literal notranslate"><span class="pre">innodb_file_format</span></code> to <code class="docutils literal notranslate"><span class="pre">Barracuda</span></code> to allow for the index sizes jupyterhub
uses. <code class="docutils literal notranslate"><span class="pre">row_format</span></code> will be set to <code class="docutils literal notranslate"><span class="pre">DYNAMIC</span></code> as long as those options are set
correctly. Later versions of MariaDB and MySQL should set these values by
default, as well as have a default <code class="docutils literal notranslate"><span class="pre">DYNAMIC</span></code> <code class="docutils literal notranslate"><span class="pre">row_format</span></code> and pose no trouble
to users.</p></li>
</ul>
</div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="rest.html" title="previous page">Using JupyterHub’s REST API</a>
    <a class='right-next' id="next-link" href="templates.html" title="next page">Working with templates and UI</a>

              </div>
              
          </main>
          

      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2016, Project Jupyter team.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>